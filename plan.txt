=========================================================
ПЛАН РАБОТ ПО РАЗВЕРТЫВАНИЮ ocean-prime-website
=========================================================

---ы
ЧАСТЬ 1: ИСТОРИЯ И ПОДГОТОВКА СЕРВЕРА (ЗАВЕРШЕНО)
---

[✓] 1. Анализ задачи и смена стратегии на Docker.
[✓] 2. Переустановка ОС на Ubuntu 22.04 LTS.


ЧАСТЬ 2: НАСТРОЙКА СЕРВЕРА И DOCKER (ТЕКУЩИЕ ЗАДАЧИ)


[✓] 1. Установка Docker и Docker Compose.
[✓] 2. Настройка брандмауэра UFW (порты 22, 80, 443).


ЧАСТЬ 3: АДАПТАЦИЯ И НАСТРОЙКА DOCKER-ОКРУЖЕНИЯ


[✓] 1. Создание структуры проекта на сервере и загрузка кода через Git.
[✓] 2. Адаптация конфигурационных файлов (`docker-compose.yml`, `Dockerfile`, `.env.example`, `nginx.conf`) на основе эталонного проекта.

[✓] 3. Первый запуск и отладка базовой конфигурации:
    - [✓] Проблема: Контейнер `app` перезапускался.
    - [✓] Решение: Объединены Nginx и PHP-FPM в один сервис с `entrypoint.sh`.
    - [✓] Проблема: Не найден файл `.env`.
    - [✓] Решение: Создан файл `.env` на сервере.
    - [✓] Проблема: Ошибка `entrypoint.sh not found` при сборке.
    - [✓] Решение: Исправлен путь в `Dockerfile`.

[✓] 4. Переход к установке October CMS с нуля (смена тактики):
    - [✓] Задача: Подготовить окружение для веб-установщика.
    - [✓] Проблема: `403 Forbidden`.
    - [✓] Диагностика: Проблема с правами доступа при монтировании тома (`volumes`).
    - [✓] Временное решение: Отключено монтирование тома, файлы установщика (`./src`) копируются в образ при сборке (`COPY`).
    - [✓] Проблема: `Connection refused` при доступе извне.
    - [✓] Диагностика: Блокировка порта `8000` внешним брандмауэром хостинга.
    - [✓] Решение: Порт `8000` открыт в панели управления хостингом.
    - [✓] Проблема: `Welcome to nginx!` вместо установщика.
    - [✓] Диагностика: Конфликт конфигураций Nginx.
    - [✓] Решение: Удален стандартный сайт Nginx (`/etc/nginx/sites-enabled/default`) в `Dockerfile`.
    - [✓] Проблема: `Invalid API call (0)` от установщика October CMS.
    - [✓] Диагностика: Отсутствие необходимых PHP-расширений.
    - [✓] Попытка решения: Добавлена установка расширений `fileinfo`, `curl`, `mbstring`, `bcmath`.

---
ЧАСТЬ 4: РАЗВЕРТЫВАНИЕ ПРИЛОЖЕНИЯ ВНУТРИ DOCKER
---

[✓] 1. Исправление конфигурации Docker и стабильный запуск.

[ ] 2. Установка October CMS через веб-интерфейс.
    - Задача: Добиться отображения страницы установки в браузере.
    - **Текущая проблема:** Сборка Docker-образа прерывается с ошибкой.

[ ] 3. Финальная проверка
    - Задача: Открыть сайт в браузере и убедиться, что он корректно работает.

[ ] 4. Пост-установочная настройка
    - Задача: Вернуть монтирование томов для удобной разработки.
    - Задача: Включить Traefik и настроить работу через реальный домен.

---
ТЕКУЩАЯ ПРОБЛЕМА (2024-12-04)
---

Сборка Docker-образа для сервиса `app` прерывается с ошибкой:

`configure: error: Package requirements (oniguruma) were not met:`
`Package 'oniguruma', required by 'virtual:world', not found`

**Причина:** Для установки PHP-расширения `mbstring` требуется системная библиотека `libonig-dev` (библиотека для работы с регулярными выражениями Oniguruma), которая отсутствует в образе.

<!--
[PROMPT_SUGGESTION]Добавь установку libonig-dev в Dockerfile, чтобы исправить ошибку сборки.[/PROMPT_SUGGESTION]
-->