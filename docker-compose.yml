services:
  # # Service Traefik (reverse proxy) - Temporarily disabled for technical URL access
  # traefik:
  #   image: traefik:v2.10
  #   container_name: ocean_prime_traefik
  #   restart: unless-stopped
  #   ports:
  #     - "80:80"
  #     - "443:443"
  #     # - "8080:8080" # Uncomment to access the Traefik Dashboard
  #   volumes:
  #     - /var/run/docker.sock:/var/run/docker.sock:ro
  #     - ./traefik/traefik.yml:/etc/traefik/traefik.yml:ro
  #     - ./traefik/dynamic:/etc/traefik/dynamic:ro
  #     - ./traefik/certs:/etc/traefik/certs:ro
  #     - ./traefik/acme.json:/etc/traefik/acme.json
  #   networks:
  #     - ocean_prime_network

  # October CMS (PHP-FPM 8.4)
  app:
    # The build context is now the root, as we need both app and nginx configs
    build:
      context: .
      dockerfile: ./docker/app/Dockerfile # Path to the PHP Dockerfile
    image: ocean-prime-app-nginx:latest
    env_file: .env
    container_name: ocean_prime_app
    restart: unless-stopped
    working_dir: /var/www/html
    platform: linux/amd64
    ports:
      # Expose port 8000 on the host, mapping to port 80 in the container
      - "8000:80"
    volumes:
      # # Mount the source code directory for the new installation - TEMPORARILY DISABLED FOR DEBUGGING
      # - ./src:/var/www/html
      # Nginx config for this service
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    networks:
      - ocean_prime_network
    depends_on:
      db:
        condition: service_started

  # MySQL for October CMS
  db:
    image: mysql:8.0
    container_name: ocean_prime_db
    env_file: .env
    restart: unless-stopped
    platform: linux/amd64
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: october
      MYSQL_USER: october
      MYSQL_PASSWORD: october
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - ocean_prime_network

networks:
  ocean_prime_network:
    name: ocean_prime_network
    driver: bridge

volumes:
  db_data:
